#!/usr/bin/env node

const app = require('../app');

if (process.env.NODE_ENV === 'production') {
    require('letsencrypt-express').create({
        server: 'https://acme-v01.api.letsencrypt.org/directory',
        email: process.env.LETSENCRYPT_EMAIL,
        agreeTos: true,
        approveDomains: [
            process.env.LETSENCRYPT_DOMAIN
        ],
        app: app
    }).listen(8080, 8443);
} else {
    app.listen(3000);
    console.log('Listening on http://localhost:3000');
}


const syncDataFolder = () => {
    try {
        const cmd = 'cd /usr/src/app/data && git add --all && git commit -am "$(date)" && git push';
        require("child_process").execSync(cmd);
    } catch (error) {
        // log - >_<
    }
    setTimeout(() => syncDataFolder(), 60 * 1000);
};

syncDataFolder();
